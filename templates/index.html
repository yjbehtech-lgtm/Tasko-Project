<!-- ===== templates/index.html ===== -->
{% extends "base.html" %}
{% block content %}
    <h1>ğŸ¯ Tasko Roll & Earn</h1>
    <p id="result">ç‚¹å‡»æŒ‰é’®è·å–ç§¯åˆ†</p>
    <button onclick="roll()">Roll</button>
    <div id="cooldown" style="margin-top: 10px;"></div>

    <script>
        function roll() {
            fetch('/click')
                .then(response => response.json())
                .then(data => {
                    const result = document.getElementById('result');
                    const cooldown = document.getElementById('cooldown');

                    if (data.error) {
                        result.innerText = "âš ï¸ " + data.error;
                        return;
                    }

                    result.innerText = `ğŸ‰ ä½ è·å¾—äº† ${data.reward} åˆ†ï¼\nğŸ« å¹¸è¿å·ç ï¼š${data.lucky_number}`;
                    cooldown.innerText = "å†·å´ä¸­ï¼š60 ç§’";
                    startCooldown(60);
                });
        }

        function startCooldown(secondsLeft) {
            const cooldownDiv = document.getElementById('cooldown');
            const button = document.querySelector('button');

            button.disabled = true;
            cooldownDiv.style.display = 'block';

            const interval = setInterval(() => {
                secondsLeft--;
                cooldownDiv.innerText = `å†·å´ä¸­ï¼š${secondsLeft} ç§’`;

                if (secondsLeft <= 0) {
                    clearInterval(interval);
                    cooldownDiv.style.display = 'none';
                    document.getElementById('result').innerText = '';
                    button.disabled = false;
                }
            }, 1000);
        }
    </script>
{% endblock %}
