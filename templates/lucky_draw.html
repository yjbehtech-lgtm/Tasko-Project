<!-- ===== templates/lucky_draw.html ===== -->
{% extends "base.html" %}
{% block content %}
    <h1>ğŸ å¹¸è¿æŠ½å¥–</h1>

    <div id="winner-section">
        <h2>ğŸ“… ä»Šæ—¥ä¸­å¥–ç»“æœ</h2>
        <p id="today-winner">æ­£åœ¨åŠ è½½ä¸­...</p>
    </div>

    <div>
        <h2>ğŸ“œ å†å²ä¸­å¥–è®°å½•</h2>
        <ul id="history-list">
            <li>æ­£åœ¨åŠ è½½ä¸­...</li>
        </ul>
    </div>

    <button onclick="window.location.href='/'">è¿”å›é¦–é¡µ</button>

    <script>
        // è·å–ä»Šæ—¥ä¸­å¥–ç»“æœ
        fetch('/api/today-winner')
            .then(res => res.json())
            .then(data => {
                const p = document.getElementById('today-winner');
                if (data.success) {
                    p.innerText = `ğŸ¯ å·ç ï¼š${data.number} ï½œ ğŸ† ç”¨æˆ· IDï¼š${data.user}`;
                } else {
                    p.innerText = 'ä»Šæ—¥å°šæœªå¼€å¥–ã€‚';
                }
            });

        // è·å–å†å²è®°å½•
        fetch('/api/lucky-history')
            .then(res => res.json())
            .then(data => {
                const ul = document.getElementById('history-list');
                ul.innerHTML = '';
                data.forEach(item => {
                    const li = document.createElement('li');
                    li.innerText = `ğŸ“… ${item.date} ï½œ ğŸ¯ ${item.number} ï½œ ğŸ† ç”¨æˆ· IDï¼š${item.user}`;
                    ul.appendChild(li);
                });
            });
    </script>
{% endblock %}
